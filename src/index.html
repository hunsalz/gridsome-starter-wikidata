<!DOCTYPE html>
<html ${htmlAttrs}>

<head>
  ${head}
  <!-- Modern mobile web app meta tag (replaces deprecated apple-mobile-web-app-capable) -->
  <meta name="mobile-web-app-capable" content="yes">
  <!-- Preconnect to Google Fonts for faster font loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="https://www.wikidata.org">
  <!-- Load Google Fonts CSS asynchronously to prevent render-blocking -->
  <!-- Modern browsers support onload on link tags, so we only need a minimal polyfill for older browsers -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"></noscript>
  <!-- Minimal polyfill only for browsers that don't support onload on link tags (IE11 and older) -->
  <script>
    // Only load polyfill if onload is not supported (modern browsers skip this)
    if (!document.createElement('link').onload) {
      (function(w){var loadCSS=function(href){var doc=w.document,ss=doc.createElement("link"),ref=doc.getElementsByTagName("head")[0].childNodes[ref.length-1];ss.rel="stylesheet";ss.href=href;ss.media="only x";function ready(cb){if(doc.body)return cb();setTimeout(function(){ready(cb)},9)}ready(function(){ref.parentNode.insertBefore(ss,ref.nextSibling)});var onloadcssdefined=function(cb){var resolvedHref=ss.href,i=doc.styleSheets.length;while(i--){if(doc.styleSheets[i].href===resolvedHref)return cb()}setTimeout(function(){onloadcssdefined(cb)},9)};ss.onloadcssdefined=onloadcssdefined;onloadcssdefined(function(){if(ss.media!=="all")ss.media="all"});return ss};w.loadCSS=loadCSS})(window);
    }
  </script>
</head>

<body ${bodyAttrs}>
  <script>
    // Modern theme detection script (ES6+ syntax for modern browsers)
    (() => {
      'use strict';
      
      window.__onThemeChange = () => {};
      
      const setTheme = (newTheme) => {
        window.__theme = newTheme;
        document.body.setAttribute('data-theme', newTheme);
        window.__onThemeChange(newTheme);
      };

      let preferredTheme;
      try {
        preferredTheme = localStorage.getItem('theme');
      } catch (err) {
        // localStorage not available
      }

      window.__setPreferredTheme = (newTheme) => {
        setTheme(newTheme);
        try {
          localStorage.setItem('theme', newTheme);
        } catch (err) {
          // localStorage not available
        }
      };

      const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
      
      // Modern browsers support addEventListener
      darkQuery.addEventListener('change', (e) => {
        window.__setPreferredTheme(e.matches ? 'dark' : 'light');
      });

      setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
    })();
  </script>

  ${app}
  ${scripts}
</body>

</html>